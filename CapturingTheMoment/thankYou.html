<!DOCTYPE html>
<html>
<head>
	<title>Beepi | Capturing the Moment</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel="stylesheet" type="text/css" href="thankYou.css">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,500,600,700,800" rel="stylesheet" type="text/css">
	<!-- <script src="https://use.fontawesome.com/1727fd84aa.js"></script> -->

	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/android-chrome-192x192.png?v=2" sizes="192x192" />
	<link rel="apple-touch-icon" sizes="180x180" href="https://static.beepi.com/images/favicon/apple-touch-icon-180x180.png?v=2" />
	<link rel="apple-touch-icon" sizes="152x152" href="https://static.beepi.com/images/favicon/apple-touch-icon-152x152.png?v=2" />
	<link rel="apple-touch-icon" sizes="144x144" href="https://static.beepi.com/images/favicon/apple-touch-icon-144x144.png?v=2" />
	<link rel="apple-touch-icon" sizes="120x120" href="https://static.beepi.com/images/favicon/apple-touch-icon-120x120.png?v=2" />
	<link rel="apple-touch-icon" sizes="114x114" href="https://static.beepi.com/images/favicon/apple-touch-icon-114x114.png?v=2" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/favicon-96x96.png?v=2" sizes="96x96" />
	<link rel="apple-touch-icon" sizes="76x76" href="https://static.beepi.com/images/favicon/apple-touch-icon-76x76.png?v=2" />
	<link rel="apple-touch-icon" sizes="72x72" href="https://static.beepi.com/images/favicon/apple-touch-icon-72x72.png?v=2" />
	<link rel="apple-touch-icon" sizes="60x60" href="https://static.beepi.com/images/favicon/apple-touch-icon-60x60.png?v=2" />
	<link rel="apple-touch-icon" sizes="57x57" href="https://static.beepi.com/images/favicon/apple-touch-icon-57x57.png?v=2" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/favicon-16x16.png?v=2" sizes="16x16" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/favicon-32x32.png?v=2" sizes="32x32" />
	<link rel="shortcut icon" href="https://static.beepi.com/images/favicon.ico?v=2" />
	<link rel="apple-touch-icon" href="https://static.beepi.com/images/favicon.ico?v=2" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/beepiIcon.png" />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.8/jquery.mask.min.js"></script>
	<script type="text/javascript">
		
	</script>
</head>
<body>
	<header class='clearfix'>
		<h1><span>Thank you,</span> Beepiers.</h1>
		<div class='toggle clearfix'>
	      <input type="radio" name="customer-type" id="filter-all" value="all" checked></input>
	      <label for='filter-all'>All</label>
	      <input type="radio" name="customer-type" id="filter-sellers" value="seller"></input>
	      <label for='filter-sellers'>Sellers</label>
	      <input type="radio" name="customer-type" id="filter-buyers" value="buyer"></input>
	      <label for='filter-buyers'>Buyers</label>
	    </div>
	</header>
	<a id='seeSmiles' onclick="exitSlideshow()">See Smiles</a>
	<ul id='slideshow' class='clearfix'>
		<!-- <li id='example' data-customer-type="seller" onclick="view('#example')" style='background-image:url(images/capturingTheMomentPhotos/20150309_155747.jpg);'>
			<button class='close'>x</button>
			<div class='details'>
				<span class='name'>John</span>, Seller #55 <span class='date'>Mar 2014</span>
			</div>
		</li> -->
	</ul>
	<a id='seeMore' onclick='
		getOriginals(50), 
		addCustomers(50)
		'>See More</a>
</body>

<script type="text/javascript" src='ogPhotos.js'></script>

<script>

function createPhoto (x,i) {
	$('ul').append(
		'<li id="smile_' + i +'" data-customer-type="' + x.type + '" ' + 'onclick="view(\'#smile_'+ i + '\')" ' + 'style="background-image:url(' + x.photo + ');">' + 
				'<div class="details">' +
					'<span class="name">' + x.first.toLowerCase() + '</span>' +
					'<div>' +
						'<span class="type">' + x.type + '</span> #<span class="number">' + x.saleID + '</span> &#8226; <span class="date">' + dateFormat(x.date) + '</span>' +
					'</div>' +
				'</div>' +
		'</li>'
	);
};
function ignoreBlanks (customer,i) {
	var tmpImg = new Image();
	tmpImg.src = customer.photo;

	$(tmpImg)
		// .on('load',function(){
		// 	createPhoto(customer,i);
	 //    })
        .on('load', createPhoto.bind(null, customer, i))
  //   $(tmpImg)
	 //    .on('error',function(){
	 //    	console.log(i+' was missing');
		// });
};

var start = 5000;

function addCustomers (interval) {
	$.ajax({
		url: "http://tinfelise.github.io/CapturingTheMoment/tyler.json",
		dataType: 'json',
		success: function(data) {
			var end = start + interval;
			
			for (i = start; i < end; i++) {
				var x = data.photos[i];

				ignoreBlanks(x,i);
				// createPhoto();
			};

			start = end + 1;
			addSelectChange();
			commaSeparate();
		}
	});
};
addCustomers(50);

// Comma separate Sale ID
function commaSeparate () {
	$('.number').mask('#,##0', {reverse: true});
};

// Date formatting
function dateFormat (date) {
	var month = date.slice(0,-date.length + 3);
	var yearStart = date.slice(4).indexOf(' ');
	var year = date.slice(4).slice(yearStart, yearStart+5);
	var formattedDate = month + ' ' + year;
	return formattedDate;
};

// Name formatting
function titleCase (name) {

};

// Playing the slideshow
var interval = setInterval(nextSlide, 3000);

function nextSlide() {
  $('#slideshow li:first')
    // .animate({'filter':'blur(5px)'})
    .fadeOut(1000)
    .next()
    .fadeIn(2000)
    .end()
    .appendTo('#slideshow');
};

function playSlideshow () {
	$('#slideshow li').hide();
 	$('#slideshow').toggleClass('grid');
 	$('header').toggleClass('grid');
 	$('#seeSmiles').show();
 	$('#seeMore').hide();
	interval = setInterval(nextSlide, 3000);
}

// stopping the Slideshow and going into grid mode
function stopSlideshow() {
  clearInterval(interval);
};

function gridMode() {
	$('#slideshow li').show();
 	$('#slideshow').toggleClass('grid');
 	$('header').toggleClass('grid');
 	$('#seeSmiles').hide();
 	// $('#seeMore').show(1000);
 	$('#seeMore').css('display','table');
};

function exitSlideshow () {
	stopSlideshow();
	gridMode();
}

// clicking on a photo to view it and creating shareable URLs
function view(smile) {
	$(smile).toggleClass('view');
	var currentURL = window.location.href;
	if (currentURL.toLowerCase().indexOf("?id=") == -1) {
		window.history.pushState(smile,smile,currentURL + '?id=' + smile);
	} else {
		var backURL = window.location.href.split('?')[0];
		window.history.pushState(null,'Thanks',backURL)
	};
};

// Filter by customer type
function customerFilter() {
	var customers = $('input[name="customer-type"]:checked').val();
	var filter ='';
	if (customers != 'all') {
		filter = '[data-customer-type!="' + customers + '"]';
	};
	// $('#slideshow li').show(500).filter(filter).hide(1000);
	$('#slideshow li').show().filter(filter).hide();
};

function addSelectChange() {
   $('input[name="customer-type"]').bind('change', customerFilter);
};

// Testing modes
// stopSlideshow();
// gridMode();
// exitSlideshow();
// view('#smile_1');

</script>

</html>