<!DOCTYPE html>
<html>
<head>
	<title>Beepi | Capturing the Moment</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel="stylesheet" type="text/css" href="thankYou.css">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,500,600,700,800" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.8/jquery.mask.min.js"></script>
	<script type="text/javascript">
		// var results = $.getJSON("http://tinfelise.github.io/CapturingTheMoment/tyler.json");
		// $( window ).on( "load", function() {
			// $('input[name="customer-type"]').change(customerToggle());
		// })
		
	</script>
</head>
<body>
	<header class='clearfix'>
		<h1><span>Thank you,</span> Beepiers.</h1>
		<div class='toggle clearfix'>
	      <input type="radio" name="customer-type" id="filter-all" value="all" checked></input>
	      <label for='filter-all'>All</label>
	      <input type="radio" name="customer-type" id="filter-sellers" value="seller"></input>
	      <label for='filter-sellers'>Sellers</label>
	      <input type="radio" name="customer-type" id="filter-buyers" value="buyer"></input>
	      <label for='filter-buyers'>Buyers</label>
	    </div>
	</header>
	<a id='seeSmiles' onclick="exitSlideshow()">See Smiles</a>
	<ul id='slideshow' class='clearfix'>
		<!-- <li id='example' data-customer-type="seller" onclick="view('#example')" style='background-image:url(images/capturingTheMomentPhotos/20150309_155747.jpg);'>
			<button class='close'>x</button>
			<div class='details'>
				<span class='name'>John</span>, Seller #55 <span class='date'>Mar 2014</span>
			</div>
		</li> -->
	</ul>
	<a id='seeMore' onclick='getOriginals(50), addCustomers(50)'>See More</a>
</body>

<!-- <script type="text/javascript" src='ogPhotos.js'></script> -->

<script>

function createPhoto (x) {
	$('ul').append(
		'<li id="smile_' + i +'" data-customer-type="' + x.type + '" ' + 'onclick="view(\'#smile_'+ i + '\')" ' + 'style="background-image:url(' + x.photo + ');">' + 
				'<div class="details">' +
					'<span class="name">' + x.first.toLowerCase() + '</span>' +
					'<div>' +
						'<span class="type">' + x.type + '</span> #<span class="number">' + x.saleID + '</span> &#8226; <span class="date">' + dateFormat(x.date) + '</span>' +
					'</div>' +
				'</div>' +
		'</li>'
	);
};
function ignoreBlanks (customer) {
	var tmpImg = new Image();
	tmpImg.src = customer.photo;
	// console.log(imageURL);
	$(tmpImg)
		.on('load',function(){
			// console.log(i+' loaded');
			// var width = tmpImg.width;
			// console.log(i+':'+imageAvailable);
			// var missing = false;
			// console.log(x.saleID+':'+width);
			createPhoto(customer);
	    })
	    // .on('load', createPhoto(customer) )
  //   $(tmpImg)
	 //    .on('error',function(){
	 //    	console.log(i+' was missing');
	 //    	// console.log(x.saleID+':Error')
	 //    	// imageAvailable = false;
	 //    	// console.log(i+':'+imageAvailable)
		// });
	// if (missing != true) { 
	// 	console.log(i);
	// 	createPhoto();
	// }
	// console.log(i+':'+missing)
};

var start = 5000;

function addCustomers (interval) {
	$.ajax({
		url: "http://tinfelise.github.io/CapturingTheMoment/tyler.json",
		dataType: 'json',
		success: function(data) {
			var end = start + interval;
			
			for (i = start; i < end; i++) {
				var x = data.photos[i];

				ignoreBlanks(x);
				// createPhoto();
			};

			start = end + 1;
			addSelectChange();
			commaSeparate();
		}
	});
};

addCustomers(50);



// function hideBlanks () {
// 	$('li').each( function() {
// 		var id = $(this).attr('id');
// 		// console.log(id);
// 		// console.log($(this).css('background-image'));
// 		var backgroundImg = $(this).css('background-image').slice(5,-2);
// 		// console.log(backgroundImg);
// 		var tmpImg = new Image();
// 		tmpImg.src = backgroundImg;
// 		// console.log('src='+tmpImg.src);
// 		$(tmpImg).on('load',function(){
// 			var width = tmpImg.width;
// 			console.log(id + ':' + width);
// 			if (width == null) {
// 			// if( typeof width === 'undefined' || width === null ){
// 	            $('li#'+id).hide();
// 	        };
// 		});
// 	});
// };

// hideBlanks();


// Comma separate Sale ID
function commaSeparate () {
	$('.number').mask('#,##0', {reverse: true});
};

// Date formatting
function dateFormat (date) {
	var month = date.slice(0,-date.length + 3);
	var yearStart = date.slice(4).indexOf(' ');
	var year = date.slice(4).slice(yearStart, yearStart+5);
	var formattedDate = month + ' ' + year;
	return formattedDate;
};

// Name formatting
function titleCase (name) {

};

// Playing the slideshow
var interval = setInterval(nextSlide, 3000);

function nextSlide() {
  $('#slideshow li:first')
    // .animate({'filter':'blur(5px)'})
    .fadeOut(1000)
    .next()
    .fadeIn(2000)
    .end()
    .appendTo('#slideshow');
};

function playSlideshow () {
	$('#slideshow li').hide();
 	$('#slideshow').toggleClass('grid');
 	$('header').toggleClass('grid');
 	$('#seeSmiles').show();
 	$('#seeMore').hide();
	interval = setInterval(nextSlide, 3000);
}

// stopping the Slideshow and going into grid mode
function stopSlideshow() {
  clearInterval(interval);
};

function gridMode() {
	$('#slideshow li').show();
 	$('#slideshow').toggleClass('grid');
 	$('header').toggleClass('grid');
 	$('#seeSmiles').hide();
 	// $('#seeMore').show(1000);
 	$('#seeMore').css('display','table');
};

function exitSlideshow () {
	stopSlideshow();
	gridMode();
}

// clicking on a photo to view it
function view(smile) {
	$(smile).toggleClass('view');
}

// Filter by customer type
function customerFilter() {
	var customers = $('input[name="customer-type"]:checked').val();
	var filter ='';
	if (customers != 'all') {
		filter = '[data-customer-type!="' + customers + '"]';
	};
	$('#slideshow li').show(500).filter(filter).hide(1000);
};

function addSelectChange() {
   $('input[name="customer-type"]').bind('change', customerFilter);
};

// Testing modes
// stopSlideshow();
// gridMode();
// exitSlideshow();
// view('#smile_1');

</script>

</html>