<!DOCTYPE html>
<html lang="en">
<head>
	<title>Beepi | Capturing the Moment</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel="stylesheet" type="text/css" href="thankYou.css">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,500,600,700,800" rel="stylesheet" type="text/css">
	<!-- <script src="https://use.fontawesome.com/1727fd84aa.js"></script> -->

	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/android-chrome-192x192.png?v=2" sizes="192x192" />
	<link rel="apple-touch-icon" sizes="180x180" href="https://static.beepi.com/images/favicon/apple-touch-icon-180x180.png?v=2" />
	<link rel="apple-touch-icon" sizes="152x152" href="https://static.beepi.com/images/favicon/apple-touch-icon-152x152.png?v=2" />
	<link rel="apple-touch-icon" sizes="144x144" href="https://static.beepi.com/images/favicon/apple-touch-icon-144x144.png?v=2" />
	<link rel="apple-touch-icon" sizes="120x120" href="https://static.beepi.com/images/favicon/apple-touch-icon-120x120.png?v=2" />
	<link rel="apple-touch-icon" sizes="114x114" href="https://static.beepi.com/images/favicon/apple-touch-icon-114x114.png?v=2" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/favicon-96x96.png?v=2" sizes="96x96" />
	<link rel="apple-touch-icon" sizes="76x76" href="https://static.beepi.com/images/favicon/apple-touch-icon-76x76.png?v=2" />
	<link rel="apple-touch-icon" sizes="72x72" href="https://static.beepi.com/images/favicon/apple-touch-icon-72x72.png?v=2" />
	<link rel="apple-touch-icon" sizes="60x60" href="https://static.beepi.com/images/favicon/apple-touch-icon-60x60.png?v=2" />
	<link rel="apple-touch-icon" sizes="57x57" href="https://static.beepi.com/images/favicon/apple-touch-icon-57x57.png?v=2" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/favicon-16x16.png?v=2" sizes="16x16" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/favicon/favicon-32x32.png?v=2" sizes="32x32" />
	<link rel="shortcut icon" href="https://static.beepi.com/images/favicon.ico?v=2" />
	<link rel="apple-touch-icon" href="https://static.beepi.com/images/favicon.ico?v=2" />
	<link rel="icon" type="image/png" href="https://static.beepi.com/images/beepiIcon.png" />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.8/jquery.mask.min.js"></script>
	
	<meta name="robots" content="noindex" />
	<meta name="robots" content="nofollow" />

	<script type="text/javascript">
		// var currentURL = window.location.href;
	</script>

</head>
<body>
	<header class='clearfix'>
		<h1><span>Thank you,</span> Beepiers.</h1>
		<div class='toggle clearfix'>
	      <input type="radio" name="customer-type" id="filter-all" value="all" checked></input>
	      <label for='filter-all'>All</label>
	      <input type="radio" name="customer-type" id="filter-originals" value="original"></input>
	      <label for='filter-originals'>OGs</label>
	      <input type="radio" name="customer-type" id="filter-sellers" value="seller"></input>
	      <label for='filter-sellers'>Sellers</label>
	      <input type="radio" name="customer-type" id="filter-buyers" value="buyer"></input>
	      <label for='filter-buyers'>Buyers</label>
	    </div>
	</header>
	<a id='seeSmiles' onclick="exitSlideshow()">See Smiles</a>
	<a id='play' onclick='restartSlideshow(), togglePlay()'>&#9658;</a>
	<ul id='slideshow' class='clearfix'></ul>
	<a id='seeMore' onclick='
		// getOriginals(50), 
		addCustomers(50),
		customerFilter()
		'>See More</a>
</body>

<script type="text/javascript" src='ogPhotos.js'></script>

<script>

// From Pradeep...
// var Counter = (function() {
// 	var count = 0;
// 	return {
// 		increment: function() {
// 			count++;
// 		}
// 	}
// })();
// {
// 	count: 1
// }
// Counter.increment();

// var ignore = [];
var ignore = ['27525', '28502', '31965', '27223', '31113', '39221', '34525', '37755', '27018', '35180', '39659', '36211', '36530', '38952', '37552', '37688', '38995', '39461', '22201', '42004', '39623', '35167', '43325', '41821', '34976', '40068', '43627', '39219', '30440', '42111', '38136', '37664', '27711', '32897', '46376', '47710', '39041', '37424', '36623', '38469', '45687', '36782', '46914', '38586', '49729', '44138', '43111', '46117', '46242', '36798', '47161', '44461', '48238', '41806', '28764', '48992', '38312', '46548', '49670', '45944', '34409', '49101', '40993', '44460', '46913', '50081', '47962', '49384', '44242', '35943', '36625', '52245', '35853', '32981', '39888', '32295', '46658', '52501', '50228', '33003', '31446', '43867', '38718', '52122', '42705', '40826', '33305', '50040', '48832', '50539', '37404', '38927', '52580', '53677', '49236', '46583', '54914', '48314', '37793', '50270', '51651', '53157', '52031', '46594', '57593', '49838', '55102', '46794', '41097', '53456', '53378', '38983', '59530', '43896', '60082', '51185', '58514', '61006', '60278', '56746', '43152', '61447', '59853', '62595', '60989', '64693', '72037', '72386', '66430', '78071', '77512', '80645', '78518', '76419', '81331', '83743', '68946', '80542', '80215', '71151', '84248', '54207', '98452', '79256', '75240', '80839', '43119'];
var rotated = ['49680', '55439', '56535', '62582', '48043', '64677', '64653', '71464', '43697', '54071', '76159', '78978', '69528', '68267', '77358', '83147', '84940', '63466', '64685', '73714', '84073', '79441', '64847', '69304', '90618', '79748', '62530', '74967', '61433', '80136', '66839', '91585', '61748', '76059', '74635', '92781', '71158', '96514', '95991', '62070', '76592', '79959', '81866', '71272', '73590', '97931', '96721', '90614', '99260'];
for (i=0; i<rotated.length; i++) {
	ignore.push(rotated[i]);
};
// console.log(ignore.length+ ' ignored');

var photoCount = 0;
function createPhoto (i) {
	var x = jsonData[i];
	$('ul').append(
		'<li id="smile_' + i +'" data-customer-type="' + x.type + '" ' + 'onclick="view(\'#smile_'+ i + '\')" ' + 'style="background-image:url(' + x.photo + ');">' + 
				'<div class="details">' +
					'<span class="name">' + x.first.toLowerCase() + '</span>' +
					'<div>' +
						'<span class="type">' + x.type + '</span> #<span class="number">' + x.saleID + '</span> &#8226; <span class="date">' + dateFormat(x.date) + 
						'</span>' +
					'</div>' +
				'</div>' +
		'</li>'
	);
	// viewSharedURL();
	commaSeparate();
	photoCount++;
};
// function ignoreBlanks (customer,i, length) {
// 	var tmpImg = new Image();
// 	tmpImg.src = customer.photo;
// 	$(tmpImg)
// 		.on('load', createPhoto.bind(null, customer, i));
// 		// .on('load',function(){
// 		// 	console.log(i+" "+ length);
// 		// 	createPhoto(customer,i);
// 		// 	if (i === length) {
// 		// 		end(i);
// 		// 	};
// 		// });
//         // .on('error',function(){console.log(i+' was missing');});
// };

// var cleanedPhotos = [];
// function checkBlanks (customer, destination) {
// 	var tmpImg = new Image();
// 	tmpImg.src = customer.photo;
// 	$(tmpImg).on('load',function(){
// 		console.log(customer.photo);
// 		destination.push(customer);
// 	});
// };
// function cleanupJSON () {
// 	$.ajax({
// 		url: "http://tinfelise.github.io/CapturingTheMoment/tyler.json",
// 		dataType: 'json',
// 		success: function(data) {
// 			var photos = data.photos;
// 			// var cleanedPhotos = [];

			// photos.forEach(function(photo, i) {
			// 	// if ( (4000 < i) && (i < 5000) ) {
			// 		if ($.inArray(photo.saleID, ignore) == -1) {
			// 			// console.log(i);
			// 			checkBlanks(photo, cleanedPhotos);
			// 		};
			// 	// };
			// });
// 			console.log(JSON.stringify(cleanedPhotos));
// 		}
// 	});
// };
// cleanupJSON();

var start = 0;
var jsonData= [];

function getCustomers (interval) {
	$.ajax({
		url: "https://tinfelise.github.io/CapturingTheMoment/data.json",
		dataType: 'json',
		success: function(data) {
			jsonData = data;
			checkSharedURL();
			addCustomers(interval);
			addSelectChange();
			createCSSslideshow();
		}
	});
};

function addCustomers (interval) {
	var end = start + interval;
	if (end > jsonData.length) {
		end = jsonData.length;
	};
	
	for (i = start; i < end; i++) {
		createPhoto(i);
	};

	var ogInterval = interval / 10;
	getOriginals(ogInterval);

	if (end < jsonData.length) {
		start = end + 1;
	} else {
		theEnd();
	};
};

// function addCustomers (interval, callback) {
// 	$.ajax({
// 		url: "https://tinfelise.github.io/CapturingTheMoment/tyler.json",
// 		dataType: 'json',
// 		success: function(data) {
// 			// jsonData = data;

// 			var end = start + interval;
// 			if (end > data.photos.length) {
// 				end = data.photos.length;
// 			};
			
// 			for (i = start; i < end; i++) {
// 				var x = data.photos[i];
// 				if ($.inArray(x.saleID, ignore) == -1) {
// 					ignoreBlanks(x,i, data.photos.length);
// 				};
// 				// createPhoto();
// 			};

// 			if (end < data.photos.length) {
// 				start = end + 1;
// 			} else {
// 				theEnd ();
// 			};

// 			// viewSharedURL();
// 			addSelectChange();
// 		},
// 		complete: function(data) {
// 			var ogInterval = interval / 100;
// 			getOriginals(ogInterval);
// 			// if (callback) {
// 			// 	callback();
// 			// };
// 		}
// 	});
// };

function theEnd () {
	console.log('No More');
	$('#seeMore').toggleClass('noMore').text('The End.');
	$('ul').append('<li id="ferris" onclick="view(\'#ferris\')"></li>');
};

// Comma separate Sale ID
function commaSeparate () {
	$('.number').mask('#,##0', {reverse: true});
};

// Date formatting
function dateFormat (date) {
	var trimmed = date.replace(/  /g, ' ');
	var month = trimmed.split(' ')[0];
	// var yearStart = date.slice(4).indexOf(' ');
	var year = trimmed.split(' ')[2];
	var formattedDate = month + ' ' + year;
	return formattedDate;
};

// Camel/ Title Case
function titleCase(str) {
  return str.toLowerCase().split(' ').map(function(word) {
    return word.replace(word[0], word[0].toUpperCase());
  }).join(' ');
};

// Playing the slideshow
function createCSSslideshow() {
	// stopSlideshow();

	var interval = 2;
	var slideCount = $('li').length;
	var runtime = slideCount * interval;
	var stagger = runtime;
	var startFade = 100 / slideCount;

	var selectors = '';
	for (i=1; i<=slideCount; i++) {
		stagger = stagger - interval;
		selectors += '#slideshow li:nth-child(' + i + ') {' +
			'animation: xfade ' + runtime + 's ' + stagger + 's infinite;' + 
			'}';
	};

	var steps = {
		'0':1,
		[startFade * .9]:1,
		[startFade]:0,
		'98':0,
		'100':1
	};
	var keyframes = '@keyframes xfade {';
	for (var i in steps) {
		keyframes += 
			i + '% {' +
				'opacity: ' + steps[i] +';' + 
			'}';
	};
	keyframes += '}'

	var css = selectors + '\n' + keyframes;
	injectStyles(css);
	// console.log(css);
};

function injectStyles(rule) {
  var stylesheet = $("<style />", {
    html: rule
  }).appendTo("body");    
};

// var interval = setInterval(nextSlide, 3000);

// function nextSlide() {
// 	$('#slideshow li:first')
// 	    // .animate({'filter':'blur(5px)'})
// 	    .fadeOut(1000)
// 	    .next()
// 	    .fadeIn(2000)
// 	    .end()
// 	    .appendTo('#slideshow');
// 	    // .fadeOut(1000)
// 	    // .end()
// 	// $('#slideshow li:first')
// 	//     .appendTo('#slideshow')
// 	//     // .end()
// 	//     .show();
// 	//     // .end();
// };

// function playSlideshow () {
// 	interval = setInterval(nextSlide, 3000);
// };

function restartSlideshow () {
	// $('#slideshow li').hide();
 	$('#slideshow').toggleClass('grid');
 	$('header').toggleClass('grid');
 	$('#seeSmiles').show();
 	$('#seeMore').hide();
	// playSlideshow();
	createCSSslideshow();
};

function togglePlay () {
	var status = $('#play').text();
	var play = '&#9658;';
	var playUTF16 = '\u25B6';
	var pause = 'II'

	if (status == play || status == playUTF16) {
		$('#play').text(pause);
	} else {
		$('#play').text(playUTF16);
	};
};

// stopping the Slideshow and going into grid mode
// function stopSlideshow() {
//   clearInterval(interval);
// };

function gridMode() {
	// $('#slideshow li').show();
 	$('#slideshow').toggleClass('grid');
 	$('header').toggleClass('grid');
 	$('#seeSmiles').hide();
 	// $('#seeMore').show(1000);
 	$('#seeMore').css('display','table');
};

function exitSlideshow () {
	// stopSlideshow();
	gridMode();
	$('#play').text('\u25B6');
};

// Metadata generation
function metadata() {
	$('head').append(
		'<!-- Facebook Open Graph Tags -->' +
		'<meta property="og:type" content="website">' +
		'<meta property="og:title" content="Beepi | Capturing The Moment">' +
		'<meta property="og:description" content="Thank you, Beepiers. Never stop making people smile.">' +
		'<meta property="og:url" content="http://tinfelise.github.io/CapturingTheMoment/thankYou.html">' +
		'<meta property="og:image" content="http://tinfelise.github.io/CapturingTheMoment/images/BeepiMosaic.png">' +
		'<meta property="og:image:width" content="568">' +
		'<meta property="og:image:height" content="568">' +
		
		'<!-- Twitter Card Tags -->' +
		'<meta name="twitter:card" content="summary_large_image">' +
		'<meta name="twitter:site" content="@beepi">' +
		'<meta name="twitter:title" content="Beepi | Capturing The Moment">' +
		'<meta name="twitter:description" content="Thank you, Beepiers. Never stop making people smile.">' +
		'<meta name="twitter:image" content="http://tinfelise.github.io/CapturingTheMoment/images/BeepiMosaic.png">'
	);
};

function jsonHeadAppend (image, x, data) {
	var name = x.first;
	var type = x.type;
	var date = dateFormat(x.date);
	var photo = x.photo;

	var height = image.height;
	var width = image.width;
	
	$('head').append(
		'<!-- Facebook Open Graph Tags -->' +
		'<meta property="og:type" content="website">' +
		'<meta property="og:title" content="Beepi | Capturing The Moment | '+ titleCase(name) + '">' +
		'<meta name="twitter:description" content="'+ 'Beepi '+ titleCase(type) + ' | '+ date +'">' +
		'<meta property="og:image" content="'+photo+'">' + 
		'<meta property="og:image:width" content="'+ width + '">' +
		'<meta property="og:image:height" content="' + height + '">' + 

		'<!-- Twitter Card Tags -->' + 
		'<meta name="twitter:card" content="summary_large_image">' +
		'<meta name="twitter:site" content="@beepi">' +
		'<meta name="twitter:title" content="Beepi | Capturing The Moment | ' + titleCase(name) + '">' +
		'<meta name="twitter:description" content="' + 'Beepi '+ titleCase(type) + ' | '+ date +'">' +
		'<meta name="twitter:image" content="' + photo + '">'
	);
};

// function jsonMetadata (i) {
// 	$.ajax({
// 		url: "http://tinfelise.github.io/CapturingTheMoment/tyler.json",
// 		dataType: 'json',
// 		success: function(data) {
// 			var x = data.photos[i];
			
// 			var tmpImg = new Image();
// 			tmpImg.src = x.photo;
// 			$(tmpImg).on('load',function() {
// 				jsonHeadAppend(tmpImg,x,i);
// 			});
// 			// .on('load', jsonHeadAppend.bind(null, tmpImg, x, i))
			
// 		}
// 	});
// };
// jsonMetadata(4837);

function jsonMetadata (i) {
	var x = jsonData[i];
	var tmpImg = new Image();
	tmpImg.src = x.photo;
	$(tmpImg).on('load',function() {
		jsonHeadAppend(tmpImg,x,i);
	});
};

// checking for shared URLs with photo ID
var currentURL = window.location.href;

function checkSharedURL () {
	if (currentURL.toLowerCase().indexOf("?id=") >= 0) {
		
		var sharedID = window.location.href.split('?id=#')[1];
		var sharedPhotoType = sharedID.split('_')[0];
		var sharedPhotoID = parseInt(sharedID.split('_')[1]);
		
		if (sharedPhotoType == 'smile') {
			// var startSave = start;
			// start = sharedPhotoID;
			// addCustomers(1);
			createPhoto(sharedPhotoID);
			jsonMetadata(sharedPhotoID);
			//start = startSave;
			//addCustomers(1000);
			// getOriginals(10);
			// view('#'+sharedID);
		} else {
			if (sharedPhotoType == 'og') {
				var photo = 'images/capturingTheMomentPhotos/' + ogPhotos[sharedPhotoID].split(' ').join('%20');
			};
			if (sharedPhotoType == 'testimonial') {
				var photo = testimonials[sharedPhotoID];
			};
			createOGPhoto(sharedPhotoID, sharedPhotoType, photo);
			OGMetadata(photo);
			// addCustomers(1000);
			// $('#'+sharedID).addClass('view');
		};
		$('#'+sharedID).addClass('view');
		exitSlideshow();
		// viewSharedURL();
		
		// console.log($('#'+sharedID));
		// console.log('test')
		// $('#'+sharedID).bind('load', viewSharedURL);

	} else {
		// addCustomers(1000);
		// getOriginals(10);
		metadata();
	};
};

// function viewSharedURL () {
// 	if (currentURL.toLowerCase().indexOf("?id=") >= 0) {
// 		var sharedID = window.location.href.split('?id=')[1];
// 		$(sharedID).addClass('view');
// 	};
// };

// clicking on a photo to view it and creating shareable URLs
function view(smile) {
	// console.log($(smile+' .number').text());
	console.log('Viewed:'+smile);
	$(smile).toggleClass('view');
	currentURL = window.location.href;
	if (currentURL.toLowerCase().indexOf("?id=") == -1) {
		window.history.pushState(smile,smile,currentURL + '?id=' + smile);
	} else {
		var backURL = window.location.href.split('?')[0];
		window.history.pushState(null,'Thanks',backURL)
	};
};

// Filter by customer type
function customerFilter() {
	var customers = $('input[name="customer-type"]:checked').val();
	var filter ='';
	if (customers != 'all') {
		filter = '[data-customer-type!="' + customers + '"]';
	};
	// $('#slideshow li').show(500).filter(filter).hide(1000);
	$('#slideshow li').show().filter(filter).hide();
};

function addSelectChange() {
   $('input[name="customer-type"]').bind('change', customerFilter);
};

// $('li').bind('load', customerFilter); //why doesn't this work?

// Execute modes
getCustomers(20);
// checkSharedURL();
// viewSharedURL();
// addCustomers(1000);
// getOriginals(10);
// stopSlideshow();
// gridMode();
// exitSlideshow();
// view('li:first-child');

// $(document).ready(function(){
// 	console.log('Doc done')
// });
// $(window).bind("load",function(){
// 	console.log('Window done')
// });

</script>

</html>